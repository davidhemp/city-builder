<!DOCTYPE html>
<html>
<head>
</head>
<body>
  <div>
    <canvas id="mainCanvas" width="800" height="600" style="border:1px solid #d3d3d3;">
      You browser does not support the HTML Canvas tag. Please use a different browser.
    </canvas>
  </div>
  <!-- Draw interface -->
  <script>
    var canvas = document.getElementById("mainCanvas"),
        cLeft = canvas.offsetLeft,
        cTop = canvas.offsetTop,
        ctx = canvas.getContext("2d");
    var elements = [];

    // Event functions
    function click_event(event){
      var x = event.pageX - cLeft,
          y = event.pageY - cTop;

      elements.forEach(function(element){
        if (y > element.top && y < element.bottom && x > element.left && x < element.right){
          element.int_function();
          draw_information();
        }
      });
    }

    // Event handlers
    canvas.addEventListener('click', click_event, false);

    // Game data
    var gameData = { food:10, people:2, houses:0};
    var dying = false;
        dead = false;

    // interface functions
    function hunt(){
      gameData.food = gameData.food + Math.floor(gameData.people/2);
    }

    function build(){
      gameData.houses++;
    }

    function gather(){
      gameData.food = gameData.food + Math.floor(gameData.people/4);
    }

    function updateResources(){
      // If there is space, increase the number of people
      if (Math.floor(gameData.people/2) < gameData.houses && gameData.food > gameData.people){
        gameData.people++;
      }

      // If there isn't enough food people start to die
      if ( gameData.food <= 0 ){
        gameData.food = 0;
        dying = true;
      } else {
        // Each person consumers 1 food
        gameData.food = gameData.food - gameData.people;
        dying = false;
      }
      // One person dies per tick while dying is true
      if ( dying == true ) {
        gameData.people -= Math.floor(gameData.people*0.1) + 1;
        if (gameData.people <= 0 ){
          dead = true;
          gameData.people = 0
          clearInterval(gameTimer);
        }
      }
      draw_information();
    }

    // Draw information area
    function draw_information(){
      ctx.clearRect(0, 0, 800, 400);
      ctx.font = "20px Arial";
      ctx.textAlign = "left";
      ctx.fillText("Food: " + gameData.food, 50, 50);
      ctx.fillText("Houses: " + gameData.houses, 50, 75);
      ctx.fillText("People: " + gameData.people, 50, 100);
      if (dead == true){
        ctx.textAlign = "center";
        ctx.font = "30px Arial";
        ctx.fillText("Everyone is DEAD!", 400, 300);
      }
      else if (dying == true) {
        ctx.fillText("People are dying!", 200, 100);
      }
    }

    // Hit boxes
    elements.push(
      { top: 400, left: 150, bottom: 500, right: 250, msg_text: "Hunt", int_function:hunt },
      { top: 400, left: 350, bottom: 500, right: 450, msg_text: "Build", int_function:build },
      { top: 400, left: 550, bottom: 500, right: 650, msg_text: "Gather", int_function:gather }
    )

    // Draw hit boxes
    elements.forEach(function(element) {
      ctx.moveTo(element.left, element.top);
      ctx.lineTo(element.right, element.top);
      ctx.lineTo(element.right, element.bottom);
      ctx.lineTo(element.left, element.bottom);
      ctx.lineTo(element.left, element.top);
      ctx.textAlign = "center";
      ctx.fillText(element.msg_text, ((element.left+element.right)/2), (element.top +element.bottom)/2);
    });

    ctx.stroke();
    draw_information();
    var gameTimer = setInterval(updateResources, 1000);

  </script>

</body>
</html>
